<?php	require("db.php");	if (isset($_SESSION['logged_user'])) {		//Клиент уже зарегистрирован и совершил вход		header ("Location: personal.php");	} else {		//клиент не совершил вход, оставляем на этой странице		$data = $_POST;		if (isset($data['log_in'])) {			//Была нажата кнопка "войти"			$errors = array();			$user = R::findOne('users', 'user_email = ?', array($data['login_email']));//поиск в бд пользователя по email			if ($user) {				//E-mail найден				if (password_verify($data['login_password'], $user->user_password)) {					$_SESSION['logged_user'] = $user;					header ("Location: /personal.php");				} else {					$errors[] = "Пароль введен неверно";				}			} else {				//E-mail не найден				$errors[] = 'Пользователь с таким E-mail не найден';			}			if (!empty($errors)) {				echo "<div class='alert alert-danger alert-dismissible fade show' role='alert'>".array_shift($errors)."<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div>";			}		} else if (isset($data['sign_up'])) {			//была нажата "зарегистрироваться"			if (trim($data['name']) == '') {				$errors[] = "Введите имя";			}			if ($data['password'] == '') {				$errors[] = "Введите пароль";			}			if ($data['password'] != $data['password_2']) {				$errors[] = "Пароли не совпадают";			}			if (trim($data['phone']) == '') {				$errors[] = "Введите номер телефона";			}			if (R::count('users', "user_phone = ?", array($data['phone'])) > 0) {				$errors[] = "Пользователь с таким номером телефона уже существует";			}			if (trim($data['email']) == '') {				$errors[] = "Введите E-mail";			} else if(!filter_var($data['email'], FILTER_VALIDATE_EMAIL)) {				$errors[] = "Введите E-mail правильно";			}			if (R::count('users', "user_email = ?", array($data['email'])) > 0) {				$errors[] = "Пользователь с таким E-mail уже существует";			}			if (trim($data['consent']) != 'on') {				$errors[] = "Подтвердите согласие";			}			if (empty($errors)) {				//нет ошибок, можно регать				$user = R::dispense('users');				$user->user_name = $data['name'];				$user->user_password = password_hash($data['password'], PASSWORD_DEFAULT);				$user->user_phone = $data['phone'];				$user->user_email = $data['email'];				R::store($user);				$_SESSION['logged_user'] = $user;				header ("Location: /personal.php");			} else {				//есть ошибки, нужно добавить класс was-validated				echo "<div class='alert alert-danger alert-dismissible fade show' role='alert'>".array_shift($errors)."<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div>";			}		} else if (isset($data['reset_password'])) {			if ($user = R::findOne('users', 'user_email = ?', array($data['email_reset']))) {				if (trim($data['email_reset']) != "" && filter_var($data['email_reset'], FILTER_VALIDATE_EMAIL)) {					$subject = "Восстановление пароля";					$to = "".$data['email_reset'];					$message = rand(100000, 999999);					$_SESSION['random_for_reset_email'] = $message;					$_SESSION['tmp_email'] = $data['email_reset'];					$_SESSION['input_code'] = '';					mail ($to, $subject, $message);						header ("Location: reset.php");				} else if (trim($data['email_reset']) == "") {					echo "<div class='alert alert-danger alert-dismissible fade show' role='alert'>Введите E-mail!<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div>";				} else if (!filter_var($data['email_reset'], FILTER_VALIDATE_EMAIL)) {					echo "<div class='alert alert-danger alert-dismissible fade show' role='alert'>Введите корректный E-mail!<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div>";				}			} else {				echo "<div class='alert alert-danger alert-dismissible fade show' role='alert'>Пользователя с таким E-mail не существует!<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div>";			}		}	}	?><!doctype html><html lang="ru"><head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no">    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->    <title>Автосервис "Минутка"</title>	<style>		body {			background: #3a2820 url("img/background.png") center no-repeat fixed;			background-size: cover;		}	</style>    <!-- Bootstrap -->    <!-- Latest compiled and minified CSS -->	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">	<link rel="stylesheet" href="css/index.css">	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>	<script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script></head><body><div class="content">			<!--Навигационная панель-->	<nav class="navbar navbar-expand-lg navbar-light">		<a class="navbar-brand" href="index.php"><img id="logo" src="img/logo.png" alt=""></a>		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">			<span class="navbar-toggler-icon"></span>		</button>		<div class="collapse navbar-collapse" id="navbarSupportedContent">			<ul class="navbar-nav mr-auto">				<li class="nav-item">					<a class="nav-link" href="index.php">Главная</a>				</li>				<li class="nav-item">					<a class="nav-link" href="news.php">Новости</a>				</li>				<li class="nav-item">					<a class="nav-link" href="carparts.php">Автозапчасти</a>				</li>				<li class="nav-item">					<a class="nav-link" href="services.php">Услуги</a>				</li>				<li class="nav-item">					<a class="nav-link" href="reviews.php">Отзывы</a>				</li>				<li class="nav-item">                    <a class="nav-link btn_" href="/appeal.php">Обратиться</a>				</li>			</ul>			<ul class="navbar-nav">				<li class="nav-link">					<?php if (isset ($_SESSION['logged_user'])) {echo "Здравствуйте, ".$_SESSION['logged_user']['user_name'];} ?>				</li>				<li class="nav-item">					<a class="nav-link btn_" href="/personal.php">Личный кабинет</a>				</li>			</ul>		</div>	</nav>			<div class="modal fade" id="_modal" tabindex="-1" role="dialog" aria-labelledby="_modal" aria-hidden="true">        <div class="modal-dialog modal-dialog-centered" role="document">            <div class="modal-content" style="background-color: #000; border: 1px solid #fff">                <div class="modal-header">                    <h5 class="modal-title" id="exampleModalLongTitle">Согласие на обработку данных</h5>                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">                        <span aria-hidden="true" style="color: #ccc">&times;</span>                    </button>                </div>                <div class="modal-body">                	<p>Предоставляя свои персональные данные Пользователь даёт согласие на обработку, хранение и использование своих персональных данных на основании ФЗ № 152-ФЗ «О персональных данных» от 27.07.2006 г. в следующих целях:</br>                        </br>                        Осуществление клиентской поддержки</br>                        Получения Пользователем информации о маркетинговых событиях</br>                        Проведения аудита и прочих внутренних исследований с целью повышения качества предоставляемых услуг.</br>                        Под персональными данными подразумевается любая информация личного характера, позволяющая установить личность Пользователя/Покупателя такая как:</br>                        </br>                        Фамилия, Имя, Отчество</br>                        Дата рождения</br>                        Контактный телефон</br>                        Адрес электронной почты</br>                        Почтовый адрес</br>                        </br>                        Персональные данные Пользователей хранятся исключительно на электронных носителях и обрабатываются с использованием автоматизированных систем, за исключением случаев, когда неавтоматизированная обработка персональных данных необходима в связи с исполнением требований законодательства.</br>                        </br>                        Компания обязуется не передавать полученные персональные данные третьим лицам, за исключением следующих случаев:</br>                        </br>                        По запросам уполномоченных органов государственной власти РФ только по основаниям и в порядке, установленным законодательством РФ</br>                        Стратегическим партнерам, которые работают с Компанией для предоставления продуктов и услуг, или тем из них, которые помогают Компании реализовывать продукты и услуги потребителям. Мы предоставляем третьим лицам минимальный объем персональных данных, необходимый только для оказания требуемой услуги или проведения необходимой транзакции.</br>                        Компания оставляет за собой право вносить изменения в одностороннем порядке в настоящие правила, при условии, что изменения не противоречат действующему законодательству РФ. Изменения условий настоящих правил вступают в силу после их публикации на Сайте.</br>                    </p>                </div>            </div>        </div>    </div>			<!--Сама форма входа/регистрации-->	<div class="container" style="text-align: center; margin-top: 20px">		<nav>  			<ul class="nav nav-tabs" id="nav-tab" role="tablist">				<li class="nav-item">    				<a class="nav-link<?php if (!isset($data['sign_up']) && !isset($data['reset_password'])) { echo " active"; } ?>" id="nav-login-tab" data-toggle="tab" href="#nav-login" role="tab" aria-controls="nav-login" aria-selected="true">Вход</a>				</li>				<li class="nav-item">					<a class="nav-link<?php if (isset($data['sign_up'])) { echo " active"; } ?>" id="nav-signup-tab" data-toggle="tab" href="#nav-signup" role="tab" aria-controls="nav-signup" aria-selected="false">Регистрация</a>				</li>				<li class="nav-item">					<a class="nav-link<?php if (isset($data['reset_password'])) { echo " active"; } ?>" id="nav-reset_password-tab" data-toggle="tab" href="#nav-reset_password" role="tab" aria-controls="nav-reset_password" aria-selected="false">Восстановить пароль</a>				</li>			</ul>		</nav>		<div class="tab-content" id="nav-tabContent">  			<div class="tab-pane fade<?php if (!isset($data['sign_up']) && !isset($data['reset_password'])) { echo " show active"; } ?>" id="nav-login" role="tabpanel" aria-labelledby="nav-login-tab">	  			<form class="needs-validation" action="autorization.php" method="post" novalidate>  					<div class="form-row">    					<div class="col-md-12 mb-3">      						<label for="login_email">Введите E-mail</label>      						<div class="input-group">        						<input type="email" class="form-control" id="login_email" name="login_email" placeholder="E-mail" value="<?php echo @$data['login_email'] ?>" required>      						</div>    					</div>  					</div>					<div class="form-row">						<div class="col-md-12 mb-3">							<label for="login_password">Введите пароль</label>							<input type="password" class="form-control" id="login_password" name="login_password" placeholder="Пароль" required>						</div>					</div>					<button class="btn btn_info" type="submit" name="log_in">Войти</button>				</form>			</div>  			<div class="tab-pane fade<?php if (isset($data['sign_up'])) { echo " show active"; } ?>" id="nav-signup" role="tabpanel" aria-labelledby="nav-signup-tab">	  			<form class="needs-validation" action="autorization.php" method="post" novalidate>					<div class="form-row">						<div class="col-md-4 mb-3">							<label for="name">Имя</label>							<input type="text" class="form-control" value="<?php echo @$data['name'] ?>" id="name" name="name" placeholder="Имя" required>						</div>						<div class="col-md-4 mb-3">							<label for="password">Пароль</label>							<input type="password" class="form-control" id="password" name="password" placeholder="Пароль" required>						</div>						<div class="col-md-4 mb-3">							<label for="password">Повторите пароль</label>							<input type="password" class="form-control" id="password_2" name="password_2" placeholder="Пароль" required>						</div>					</div>					<div class="form-row">						<div class="col-md-6 mb-3">							<label for="phone">Номер телефона</label>							<div class="input-group">								<div class="input-group-prepend">									<span class="input-group-text" id="basic-addon1">+7</span>								</div>      							<input type="text" class="form-control" value="<?php echo @$data['phone'] ?>" id="phone" name="phone" placeholder="Номер телефона" required>							</div>						</div>						<div class="col-md-6 mb-3">							<label for="e-mail">E-mail</label>							<input type="email" class="form-control" value="<?php echo @$data['email'] ?>" id="e-mail" name="email" placeholder="E-mail" required>						</div>						<div class="custom-control custom-checkbox mb-3">							<input type="checkbox" class="custom-control-input" id="consent" name="consent" required>							<label class="custom-control-label" for="consent">Я согласен(-а) с <a class="link__" data-toggle="modal" data-target="#_modal">правилами</a></label>							<div class="invalid-feedback">Подтвердите согласие!</div>						</div>					</div>					<button class="btn btn_info" type="submit" id="sign_up" name="sign_up">Зарегистрироваться</button>				</form>			</div>			<div class="tab-pane fade<?php if (isset($data['reset_password'])) { echo " show active"; } ?>" id="nav-reset_password" role="tabpanel" aria-labelledby="nav-reset_password-tab">	  			<form class="needs-validation" action="autorization.php" method="post" novalidate>  					<div class="form-row">    					<div class="col-md-12 mb-3">      						<label for="email_reset">Введите E-mail</label>      						<div class="input-group">        						<input type="email_reset" class="form-control" id="email_reset" name="email_reset" placeholder="E-mail" required>      						</div>    					</div>  					</div>					<button class="btn btn_info" type="submit" name="reset_password">Восстановить</button>				</form>			</div>		</div>	</div></div>			<!--Footer-->	<footer class="footer">		<div style="background-color: black">      		<div class="container" style="padding: 20px 0px">        		<span class="text-muted" id="spn">Все права защищены &copy 2019</span>      		</div>		</div>    </footer>	<script src="js/jquery.maskedinput.min.js"></script><script>	$(function(){	  	$("#phone").mask("(999) 999-99-99");	});</script>		</body></html>